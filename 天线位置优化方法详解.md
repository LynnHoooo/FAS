# å¤©çº¿ä½ç½®ä¼˜åŒ–å­é—®é¢˜è¯¦è§£

## ğŸ“‹ ç›®å½•
1. [ä¼˜åŒ–é—®é¢˜æè¿°](#ä¼˜åŒ–é—®é¢˜æè¿°)
2. [ä¼˜åŒ–æ–¹æ³•ï¼šSCAï¼ˆè¿ç»­å‡¸è¿‘ä¼¼ï¼‰](#ä¼˜åŒ–æ–¹æ³•scaè¿ç»­å‡¸è¿‘ä¼¼)
3. [ç›®æ ‡å‡½æ•°çº¿æ€§åŒ–](#ç›®æ ‡å‡½æ•°çº¿æ€§åŒ–)
4. [æ¢¯åº¦è®¡ç®—](#æ¢¯åº¦è®¡ç®—)
5. [å®Œæ•´ä¼˜åŒ–æµç¨‹](#å®Œæ•´ä¼˜åŒ–æµç¨‹)
6. [å®ç°ç»†èŠ‚](#å®ç°ç»†èŠ‚)

---

## 1. ä¼˜åŒ–é—®é¢˜æè¿°

### 1.1 ä¼˜åŒ–ç›®æ ‡
**æœ€å¤§åŒ–é€šä¿¡å’Œé€Ÿç‡**ï¼Œç»™å®šå›ºå®šçš„æ³¢æŸWå’ŒRï¼š

```
æœ€å¤§åŒ–ï¼šR_sum(t) = Î£_{m,k,n} Î±_{m,k}[n] Â· logâ‚‚(1 + SINR_{m,k}[n](t))
```

å…¶ä¸­ï¼š
- `t = [tâ‚, tâ‚‚, ..., t_Na]^T`ï¼šå¤©çº¿ä½ç½®å‘é‡ï¼ˆä¼˜åŒ–å˜é‡ï¼‰
- `SINR_{m,k}[n](t)`ï¼šä¿¡å¹²å™ªæ¯”ï¼Œä¾èµ–äºä½ç½®tï¼ˆé€šè¿‡ä¿¡é“h(t)ï¼‰

### 1.2 çº¦æŸæ¡ä»¶
1. **è¾¹ç•Œçº¦æŸ**ï¼š`t_m âˆˆ [0, D]`ï¼Œå¯¹æ‰€æœ‰ `m = 1, 2, ..., Na`
   - ç‰¹åˆ«åœ°ï¼š`t_start â‰¤ tâ‚` ä¸” `t_Na â‰¤ t_end`
2. **æœ€å°é—´è·çº¦æŸ**ï¼š`|t_m - t_n| â‰¥ d_min`ï¼Œå¯¹æ‰€æœ‰ `m â‰  n`
   - ç­‰ä»·äºï¼š`tâ‚ < tâ‚‚ < ... < t_Na` ä¸” `t_{i+1} - t_i â‰¥ d_min`

### 1.3 é—®é¢˜ç‰¹æ€§
- **éå‡¸ä¼˜åŒ–é—®é¢˜**ï¼šç›®æ ‡å‡½æ•°R_sum(t)å…³äºä½ç½®tæ˜¯éå‡¸çš„
- **åŸå› **ï¼š
  - ä¿¡é“h(t) = sqrt(Î²) Â· exp(1j Â· 2Ï€ Â· t Â· cos(Î¸)) å…³äºtæ˜¯éçº¿æ€§çš„
  - SINRä¾èµ–äºh(t)çš„äºŒæ¬¡å‹ï¼š`h'*W*h`
  - å³ä½¿logâ‚‚(1+SINR)æ˜¯å‡¹å‡½æ•°ï¼Œä½†SINR(t)æœ¬èº«æ˜¯tçš„éå‡¸å‡½æ•°

---

## 2. ä¼˜åŒ–æ–¹æ³•ï¼šSCAï¼ˆè¿ç»­å‡¸è¿‘ä¼¼ï¼‰

### 2.1 SCAåŸºæœ¬æ€æƒ³
ç”±äºç›®æ ‡å‡½æ•°R_sum(t)æ˜¯éå‡¸çš„ï¼Œæ— æ³•ç›´æ¥ä½¿ç”¨å‡¸ä¼˜åŒ–æ±‚è§£ã€‚SCAæ–¹æ³•é€šè¿‡ä»¥ä¸‹æ­¥éª¤å¤„ç†ï¼š

1. **çº¿æ€§åŒ–**ï¼šåœ¨å½“å‰ä½ç½®t_oldé™„è¿‘ï¼Œä½¿ç”¨ä¸€é˜¶æ³°å‹’å±•å¼€çº¿æ€§åŒ–ç›®æ ‡å‡½æ•°
2. **è¿­ä»£ä¼˜åŒ–**ï¼šæ±‚è§£çº¿æ€§åŒ–åçš„å‡¸é—®é¢˜ï¼Œå¾—åˆ°æ–°ä½ç½®t_new
3. **æ›´æ–°è¿­ä»£ç‚¹**ï¼šä»¤t_old = t_newï¼Œé‡å¤æ­¥éª¤1-2ç›´åˆ°æ”¶æ•›

### 2.2 SCAç®—æ³•æ¡†æ¶
```matlab
% åˆå§‹åŒ–
t_old = t_init;  % åˆå§‹ä½ç½®

for sca_iter = 1:max_sca_iter
    % æ­¥éª¤1ï¼šçº¿æ€§åŒ–ç›®æ ‡å‡½æ•° R_sum(t) åœ¨ t_old å¤„
    % R_sum(t) â‰ˆ R_sum(t_old) + âˆ‡R_sum(t_old)^T Â· (t - t_old)
    
    % æ­¥éª¤2ï¼šæ±‚è§£çº¿æ€§åŒ–åçš„å‡¸é—®é¢˜
    cvx_begin
        variable t_var(Na, 1)
        maximize( R_sum(t_old) + gradient' * (t_var - t_old) )
        subject to
            % è¾¹ç•Œçº¦æŸ
            t_var >= 0;
            t_var <= D;
            t_var(1) >= t_start;
            t_var(Na) <= t_end;
            % æœ€å°é—´è·çº¦æŸ
            for i = 1:Na-1
                t_var(i+1) >= t_var(i) + d_min;
            end
    cvx_end
    
    % æ­¥éª¤3ï¼šæ›´æ–°è¿­ä»£ç‚¹
    t_old = t_var;
    
    % æ­¥éª¤4ï¼šæ”¶æ•›åˆ¤æ–­
    if converged, break; end
end
```

---

## 3. ç›®æ ‡å‡½æ•°çº¿æ€§åŒ–

### 3.1 ç›®æ ‡å‡½æ•°å½¢å¼
é€šä¿¡å’Œé€Ÿç‡ï¼š
```
R_sum(t) = Î£_{m,k,n} Î±_{m,k}[n] Â· logâ‚‚(1 + SINR_{m,k}[n](t))
```

å…¶ä¸­SINRå®šä¹‰ä¸ºï¼š
```
SINR_{m,k}[n](t) = signal_power / (interference + noise)
                 = (h_mk' * W_mk * h_mk) / (I + ÏƒÂ²)
```

### 3.2 ä¿¡é“ä¸ä½ç½®çš„å…³ç³»
ä¿¡é“å‘é‡ä¾èµ–äºä½ç½®tï¼š
```
h_mk(t) = sqrt(Î²) Â· g_mk(t)
```

å¯¼å‘çŸ¢é‡ï¼š
```
g_mk(t) = exp(1j Â· 2Ï€ Â· t Â· cos(Î¸_mk))
        = [exp(1jÂ·2Ï€Â·tâ‚Â·cos(Î¸)), exp(1jÂ·2Ï€Â·tâ‚‚Â·cos(Î¸)), ..., exp(1jÂ·2Ï€Â·t_NaÂ·cos(Î¸))]^T
```

### 3.3 çº¿æ€§åŒ–æ–¹æ³•

#### æ–¹æ³•1ï¼šç›´æ¥çº¿æ€§åŒ–R_sum(t)ï¼ˆç®€å•ä½†ä¸å¤Ÿç²¾ç¡®ï¼‰âŒ
```matlab
% ä¸€é˜¶æ³°å‹’å±•å¼€
R_sum(t) â‰ˆ R_sum(t_old) + âˆ‡R_sum(t_old)^T Â· (t - t_old)
```
**ç¼ºç‚¹**ï¼š
- ä¸¢å¤±äº†logå‡½æ•°çš„å‡¹æ€§ç»“æ„
- å¯èƒ½ä¸å¤Ÿç²¾ç¡®
- æ”¶æ•›æ€§å¯èƒ½è¾ƒå·®

#### æ–¹æ³•2ï¼šä¸¤æ­¥SCAæ–¹æ³•ï¼ˆæ¨èï¼Œæ›´ä¸¥æ ¼ï¼‰âœ…
è¿™æ˜¯**æ ‡å‡†çš„SCAæ–¹æ³•**ï¼Œåˆ†ä¸¤æ­¥å¤„ç†éå‡¸æ€§ï¼š

**ç¬¬ä¸€æ­¥ï¼šçº¿æ€§åŒ–åŠŸç‡é¡¹g(t)**
```matlab
% åŠŸç‡é¡¹ï¼šg_mjk(t) = |w_mj^H * h_mk(t)|^2
% çº¿æ€§åŒ–ï¼šg_mjk(t) â‰ˆ g_mjk(t_old) + âˆ‡g_mjk(t_old)^T Â· (t - t_old)
```

**ç¬¬äºŒæ­¥ï¼šåˆ©ç”¨logå‡½æ•°çš„å‡¹æ€§å’ŒDCå½¢å¼**
```matlab
% å°†é€Ÿç‡æ”¹å†™ä¸ºDCå½¢å¼ï¼š
% R_mk(t) = logâ‚‚(S + I) - logâ‚‚(I)
%        = fâ‚(t) - fâ‚‚(t)

% å…¶ä¸­ï¼š
% fâ‚(t) = logâ‚‚(Î£_j |w_mj^H * h_mk(t)|Â² + ÏƒÂ²)  (æ€»åŠŸç‡çš„å¯¹æ•°)
% fâ‚‚(t) = logâ‚‚(Î£_{jâ‰ k} |w_mj^H * h_mk(t)|Â² + ÏƒÂ²)  (å¹²æ‰°åŠŸç‡çš„å¯¹æ•°)

% ç¬¬ä¸€æ­¥SCAåï¼š
% fâ‚(t) â‰ˆ logâ‚‚(Î£_j gÌƒ_mjk(t) + ÏƒÂ²)  (å‡¹å‡½æ•°ï¼Œå› ä¸ºlog(ä»¿å°„)æ˜¯å‡¹çš„)
% fâ‚‚(t) â‰ˆ logâ‚‚(Î£_{jâ‰ k} gÌƒ_mjk(t) + ÏƒÂ²)  (å‡¹å‡½æ•°)

% ç¬¬äºŒæ­¥SCAï¼šå¯¹fâ‚‚ä½¿ç”¨ä¸€é˜¶æ³°å‹’ä¸Šç•Œ
% fÌ‚â‚‚(t) = fâ‚‚(t_old) + âˆ‡fâ‚‚(t_old)^T Â· (t - t_old)  (ä»¿å°„ä¸Šç•Œ)

% æœ€ç»ˆç›®æ ‡å‡½æ•°ï¼ˆçº¯å‡¹å‡½æ•°ï¼‰ï¼š
% R_mk(t) â‰ˆ fÌƒâ‚(t) - fÌ‚â‚‚(t)  (å‡¹å‡½æ•° - ä»¿å°„å‡½æ•° = å‡¹å‡½æ•°)
```

**æ¨èä½¿ç”¨æ–¹æ³•2**ï¼Œå› ä¸ºï¼š
- âœ… **æ•°å­¦ä¸Šæ›´ä¸¥æ ¼**ï¼šå……åˆ†åˆ©ç”¨äº†logå‡½æ•°çš„å‡¹æ€§
- âœ… **æ›´å¥½çš„æ”¶æ•›æ€§**ï¼šä¿æŒäº†é—®é¢˜çš„ç»“æ„ä¿¡æ¯
- âœ… **ä¸ç†è®ºä¸€è‡´**ï¼šæ ‡å‡†çš„DCè§„åˆ’å’ŒSCAæ–¹æ³•
- âœ… **ä¸æ³¢æŸä¼˜åŒ–ä¸€è‡´**ï¼šä½¿ç”¨ç›¸åŒçš„SCAæ¡†æ¶

---

## 4. æ¢¯åº¦è®¡ç®—ï¼ˆä¸¤æ­¥SCAæ–¹æ³•ï¼‰

### 4.1 æ¢¯åº¦1ï¼šåŠŸç‡é¡¹g(t)å…³äºä½ç½®tçš„æ¢¯åº¦

**åŠŸç‡é¡¹å®šä¹‰**ï¼š
```
g_mjk(t) = |w_mj^H * h_mk(t)|Â²
```

**ä¿¡é“æ¨¡å‹**ï¼š
```
h_mk(t) = sqrt(Î²) Â· a(t, Î¸)
a(t, Î¸) = [exp(1jÂ·2Ï€Â·tâ‚Â·cos(Î¸)), ..., exp(1jÂ·2Ï€Â·t_NaÂ·cos(Î¸))]^T
```

**æ¢¯åº¦è®¡ç®—**ï¼š

å¯¹ç¬¬læ ¹å¤©çº¿ä½ç½®t_læ±‚åå¯¼æ•°ï¼š
```
âˆ‚g/âˆ‚t_l = 2 Â· Re{ (w^H * h(t))^* Â· âˆ‚(w^H * h(t))/âˆ‚t_l }
```

å…¶ä¸­ï¼š
```
âˆ‚(w^H * h(t))/âˆ‚t_l = w_l^* Â· âˆ‚h_l(t)/âˆ‚t_l
                   = w_l^* Â· sqrt(Î²) Â· (1j Â· 2Ï€ Â· cos(Î¸) Â· exp(1jÂ·2Ï€Â·t_lÂ·cos(Î¸)))
                   = 1j Â· 2Ï€ Â· cos(Î¸) Â· w_l^* Â· h_l(t)
```

å› æ­¤ï¼š
```
âˆ‚g/âˆ‚t_l = 2 Â· Re{ (w^H * h(t))^* Â· (1j Â· 2Ï€ Â· cos(Î¸) Â· w_l^* Â· h_l(t)) }
        = 2 Â· Re{ 1j Â· 2Ï€ Â· cos(Î¸) Â· (w^H * h(t))^* Â· w_l^* Â· h_l(t) }
```

**MATLABå®ç°**ï¼š
```matlab
function grad_g = compute_grad_g(w, h, t, cos_theta)
    % è®¡ç®— g(t) = |w^H * h(t)|Â² å…³äº t çš„æ¢¯åº¦
    
    Na = length(t);
    grad_g = zeros(Na, 1);
    
    % w^H * h(t)
    wHh = w' * h;
    
    % å¸¸æ•°
    phi = 2*pi * cos_theta;
    
    for l = 1:Na
        % âˆ‚(w^H * h)/âˆ‚t_l = 1j * phi * w_l^* * h_l
        d_wHh_dtl = 1j * phi * conj(w(l)) * h(l);
        
        % âˆ‚g/âˆ‚t_l = 2 * Re{ (w^H * h)^* * âˆ‚(w^H * h)/âˆ‚t_l }
        grad_g(l) = 2 * real(conj(wHh) * d_wHh_dtl);
    end
end
```

### 4.2 æ¢¯åº¦2ï¼šfâ‚‚(t)å…³äºä½ç½®tçš„æ¢¯åº¦

**fâ‚‚(t)å®šä¹‰**ï¼š
```
fâ‚‚(t) = logâ‚‚(Î£_{jâ‰ k} g_mjk(t) + ÏƒÂ²)
      = (1/ln2) Â· ln(Î£_{jâ‰ k} g_mjk(t) + ÏƒÂ²)
```

**ç¬¬ä¸€æ­¥SCAå**ï¼š
```
fÌƒâ‚‚(t) = logâ‚‚(Î£_{jâ‰ k} gÌƒ_mjk(t) + ÏƒÂ²)
      = logâ‚‚(Î£_{jâ‰ k} [g_mjk(t_old) + âˆ‡g_mjk(t_old)^T Â· (t - t_old)] + ÏƒÂ²)
```

**æ¢¯åº¦è®¡ç®—**ï¼š

ä»¤ `A(t) = Î£_{jâ‰ k} gÌƒ_mjk(t) + ÏƒÂ²`ï¼ˆè¿™æ˜¯tçš„ä»¿å°„å‡½æ•°ï¼‰

```
âˆ‡fÌƒâ‚‚(t) = (1/ln2) Â· (1/A(t)) Â· âˆ‡A(t)
```

å…¶ä¸­ï¼š
```
âˆ‡A(t) = Î£_{jâ‰ k} âˆ‡g_mjk(t_old)  (å¸¸æ•°å‘é‡)
```

åœ¨ `t = t_old` å¤„æ±‚å€¼ï¼š
```
A(t_old) = Î£_{jâ‰ k} g_mjk(t_old) + ÏƒÂ² = I_mk(t_old)
```

å› æ­¤ï¼š
```
âˆ‡fÌƒâ‚‚(t_old) = (1/(ln2 Â· I_mk(t_old))) Â· Î£_{jâ‰ k} âˆ‡g_mjk(t_old)
```

**MATLABå®ç°**ï¼š
```matlab
function grad_f2 = compute_grad_f2(g_all, grad_g_all, k, sigma2)
    % è®¡ç®— fâ‚‚(t) å…³äº t çš„æ¢¯åº¦
    
    % I_mk = Î£_{jâ‰ k} g_j + ÏƒÂ²
    I_mk = sum(g_all) - g_all(k) + sigma2;
    
    % âˆ‡A = Î£_{jâ‰ k} âˆ‡g_j
    grad_A = sum(grad_g_all, 2) - grad_g_all(:, k);
    
    % âˆ‡fâ‚‚ = (1/(ln2 Â· I_mk)) Â· âˆ‡A
    grad_f2 = (1 / (log(2) * I_mk)) * grad_A;
end
```

### 4.3 å®Œæ•´æ¢¯åº¦è®¡ç®—æµç¨‹

```matlab
function [grad_g_all, grad_f2_all] = compute_all_gradients(...
    t_old, W_mkn, R_mkn, alpha_mkn, u, v, H_sense, M, K, N, Na, kappa, sigma2)
    
    % åˆå§‹åŒ–
    grad_g_all = cell(M, K, N, K);  % grad_g_all{m,k,n,j} = âˆ‡g_mjk
    grad_f2_all = cell(M, K, N);    % grad_f2_all{m,k,n} = âˆ‡fâ‚‚
    
    for m = 1:M
        for k = 1:K
            for n = 1:N
                if alpha_mkn(m, k, n) == 0, continue; end
                
                % è®¡ç®—ä¿¡é“ h_mk(t_old)
                h_mk = compute_channel_with_positions(m, k, n, ...
                    u, v, H_sense, t_old, kappa, Na);
                cos_theta = compute_cos_theta(m, k, n, u, v, H_sense);
                
                % è®¡ç®—æ‰€æœ‰ g_mjk å’Œ âˆ‡g_mjk
                g_all = zeros(K, 1);
                grad_g_all_mkn = zeros(Na, K);
                
                for j = 1:K
                    w_mj = extract_beamforming_vector(W_mkn{m,j,n});  % éœ€è¦ä»çŸ©é˜µæå–å‘é‡
                    g_all(j) = abs(w_mj' * h_mk)^2;
                    grad_g_all_mkn(:, j) = compute_grad_g(w_mj, h_mk, t_old, cos_theta);
                end
                
                % å­˜å‚¨
                for j = 1:K
                    grad_g_all{m,k,n,j} = grad_g_all_mkn(:, j);
                end
                
                % è®¡ç®— âˆ‡fâ‚‚
                grad_f2_all{m,k,n} = compute_grad_f2(g_all, grad_g_all_mkn, k, sigma2);
            end
        end
    end
end
```

### 4.4 æ•°å€¼æ¢¯åº¦ï¼ˆå¤‡é€‰æ–¹æ¡ˆï¼Œä¸æ¨èï¼‰

å¦‚æœè§£ææ¢¯åº¦å®ç°å›°éš¾ï¼Œå¯ä»¥ä½¿ç”¨æ•°å€¼æ¢¯åº¦ä½œä¸ºå¤‡é€‰ï¼š
```matlab
function gradient = compute_gradient_numerical(t_old, W, R, alpha, ...)
    epsilon = 1e-6;  % æ‰°åŠ¨æ­¥é•¿
    gradient = zeros(Na, 1);
    R_old = compute_sum_rate(t_old, W, R, alpha, ...);
    
    for m = 1:Na
        t_perturbed = t_old;
        t_perturbed(m) = t_old(m) + epsilon;
        R_perturbed = compute_sum_rate(t_perturbed, W, R, alpha, ...);
        gradient(m) = (R_perturbed - R_old) / epsilon;
    end
end
```

**ä¸æ¨èçš„åŸå› **ï¼š
- âŒ è®¡ç®—å¼€é”€å¤§ï¼ˆéœ€è¦Na+1æ¬¡å‡½æ•°è¯„ä¼°ï¼‰
- âŒ ç²¾åº¦ä¾èµ–äºæ­¥é•¿Îµ
- âŒ æ— æ³•å……åˆ†åˆ©ç”¨é—®é¢˜ç»“æ„
- âœ… **æ¨èä½¿ç”¨è§£ææ¢¯åº¦**ï¼Œæ›´é«˜æ•ˆã€æ›´ç²¾ç¡®

---

## 5. å®Œæ•´ä¼˜åŒ–æµç¨‹

### 5.1 ç®—æ³•ä¼ªä»£ç 

```
ç®—æ³•ï¼šå¤©çº¿ä½ç½®ä¼˜åŒ–ï¼ˆSCAæ–¹æ³•ï¼‰

è¾“å…¥ï¼š
  - t_init: åˆå§‹ä½ç½®å‘é‡
  - W, R: å›ºå®šæ³¢æŸï¼ˆé€šä¿¡å’Œæ„ŸçŸ¥ï¼‰
  - alpha: å…³è”ç­–ç•¥
  - å…¶ä»–ç³»ç»Ÿå‚æ•°

è¾“å‡ºï¼š
  - t_opt: ä¼˜åŒ–åçš„ä½ç½®å‘é‡

æ­¥éª¤ï¼š
1. åˆå§‹åŒ–ï¼št_old = t_init
2. å¯¹äº sca_iter = 1, 2, ..., max_sca_iterï¼š
   a. è®¡ç®—å½“å‰ä½ç½®çš„ç›®æ ‡å€¼ï¼šR_old = R_sum(t_old)
   b. è®¡ç®—æ¢¯åº¦ï¼šgradient = âˆ‡R_sum(t_old)
   c. æ„å»ºçº¿æ€§åŒ–ç›®æ ‡å‡½æ•°ï¼š
      R_linear(t) = R_old + gradient^T Â· (t - t_old)
   d. æ±‚è§£å‡¸ä¼˜åŒ–é—®é¢˜ï¼š
      t_new = argmax R_linear(t)
                  s.t. t âˆˆ [0, D]
                       tâ‚ >= t_start
                       t_Na <= t_end
                       t_{i+1} - t_i >= d_min
   e. æ›´æ–°ï¼št_old = t_new
   f. æ”¶æ•›åˆ¤æ–­ï¼šå¦‚æœ |R_sum(t_new) - R_sum(t_old)| < tolï¼Œé€€å‡º
3. è¿”å›ï¼št_opt = t_old
```

### 5.2 MATLABå®ç°æ¡†æ¶ï¼ˆä¸¤æ­¥SCAæ–¹æ³•ï¼‰

```matlab
function [t_opt, obj_history] = optimize_antenna_position(...
    h_mkn_precomputed, alpha_mkn, W_mkn, R_mkn, ...
    u, v, H_sense, M, K, N, Na, Q, t_init, t_start, t_end, d_min, ...
    kappa, Pmax, Gamma, sigma2)

    % ========== åˆå§‹åŒ– ==========
    t_old = t_init;
    obj_history = [];
    max_sca_iter = 20;
    tol = 1e-4;
    
    % ========== SCAè¿­ä»£ ==========
    for sca_iter = 1:max_sca_iter
        fprintf('  SCAè¿­ä»£ %d/%d\n', sca_iter, max_sca_iter);
        
        % æ­¥éª¤1ï¼šè®¡ç®—å½“å‰ç›®æ ‡å€¼
        R_old = compute_sum_rate_with_positions(t_old, W_mkn, R_mkn, ...
            alpha_mkn, u, v, H_sense, M, K, N, Na, kappa, sigma2);
        obj_history(end+1) = R_old;
        fprintf('    å½“å‰å’Œé€Ÿç‡: %.4f bps/Hz\n', R_old);
        
        % æ­¥éª¤2ï¼šæ„å»ºä¸¤æ­¥SCAçš„çº¿æ€§åŒ–ç›®æ ‡å‡½æ•°
        cvx_begin quiet
            variable t_var(Na, 1)
            
            % ========== æ„å»ºçº¿æ€§åŒ–ç›®æ ‡å‡½æ•°ï¼ˆä¸¤æ­¥SCAï¼‰ ==========
            obj_linearized = 0;
            
            for n = 1:N
                for m = 1:M
                    for k = 1:K
                        if alpha_mkn(m, k, n) == 0, continue; end
                        
                        % --- è®¡ç®—ä¿¡é“å’Œè§’åº¦ ---
                        h_mk = compute_channel_with_positions(m, k, n, ...
                            u, v, H_sense, t_old, kappa, Na);
                        cos_theta = compute_cos_theta(m, k, n, u, v, H_sense);
                        
                        % --- æ­¥éª¤2.1: è®¡ç®—æ‰€æœ‰ g_mjk(t_old) å’Œ âˆ‡g_mjk(t_old) ---
                        g_all = zeros(K, 1);
                        grad_g_all = zeros(Na, K);
                        
                        for j = 1:K
                            w_mj = extract_beamforming_vector(W_mkn{m,j,n});
                            g_all(j) = abs(w_mj' * h_mk)^2;
                            grad_g_all(:, j) = compute_grad_g(w_mj, h_mk, t_old, cos_theta);
                        end
                        
                        % --- æ­¥éª¤2.2: æ„å»º fÌƒâ‚(t) (å‡¹å‡½æ•°) ---
                        % fÌƒâ‚(t) = logâ‚‚(Î£_j gÌƒ_mjk(t) + ÏƒÂ²)
                        % å…¶ä¸­ gÌƒ_mjk(t) = g_mjk(t_old) + âˆ‡g_mjk(t_old)^T Â· (t - t_old)
                        
                        % è®¡ç®—ä»¿å°„å‡½æ•°ï¼šÎ£_j gÌƒ_mjk(t) + ÏƒÂ²
                        sum_g_tilde = sum(g_all) + sum(grad_g_all, 2)' * (t_var - t_old) + sigma2;
                        
                        % fÌƒâ‚(t) = logâ‚‚(ä»¿å°„å‡½æ•°) æ˜¯å‡¹å‡½æ•°
                        tilde_f1 = log(sum_g_tilde) / log(2);  % CVXè¯†åˆ«ä¸ºconcave
                        
                        % --- æ­¥éª¤2.3: æ„å»º fÌ‚â‚‚(t) (ä»¿å°„ä¸Šç•Œ) ---
                        % fÌ‚â‚‚(t) = fâ‚‚(t_old) + âˆ‡fâ‚‚(t_old)^T Â· (t - t_old)
                        
                        % I_mk(t_old) = Î£_{jâ‰ k} g_mjk(t_old) + ÏƒÂ²
                        I_mk = sum(g_all) - g_all(k) + sigma2;
                        
                        % fâ‚‚(t_old)
                        f2_val = log(I_mk) / log(2);
                        
                        % âˆ‡fâ‚‚(t_old)
                        grad_g_interference = sum(grad_g_all, 2) - grad_g_all(:, k);
                        grad_f2 = (1 / (log(2) * I_mk)) * grad_g_interference;
                        
                        % fÌ‚â‚‚(t) = fâ‚‚(t_old) + âˆ‡fâ‚‚(t_old)^T Â· (t - t_old)
                        hat_f2 = f2_val + grad_f2' * (t_var - t_old);
                        
                        % --- æ­¥éª¤2.4: ç´¯åŠ åˆ°æ€»ç›®æ ‡å‡½æ•° ---
                        % R_mk(t) â‰ˆ fÌƒâ‚(t) - fÌ‚â‚‚(t)  (å‡¹å‡½æ•° - ä»¿å°„å‡½æ•° = å‡¹å‡½æ•°)
                        obj_linearized = obj_linearized + alpha_mkn(m,k,n) * (tilde_f1 - hat_f2);
                    end
                end
            end
            
            % ========== ä¼˜åŒ–é—®é¢˜ ==========
            maximize(obj_linearized)
            
            subject to
                % è¾¹ç•Œçº¦æŸ
                t_var >= 0;
                t_var <= (t_end - t_start);
                t_var(1) >= 0;  % ç¬¬ä¸€æ ¹å¤©çº¿
                t_var(Na) <= (t_end - t_start);  % æœ€åä¸€æ ¹å¤©çº¿
                
                % æœ€å°é—´è·çº¦æŸ
                for i = 1:Na-1
                    t_var(i+1) >= t_var(i) + d_min;
                end
        cvx_end
        
        % æ£€æŸ¥CVXçŠ¶æ€
        if ~strcmp(cvx_status, 'Solved') && ~strcmp(cvx_status, 'Inaccurate/Solved')
            warning('CVXæœªæ”¶æ•›ï¼ŒçŠ¶æ€: %s', cvx_status);
            break;
        end
        
        % æ­¥éª¤3ï¼šæ›´æ–°ä½ç½®
        t_new = t_var;
        
        % æ­¥éª¤4ï¼šè®¡ç®—æ–°ç›®æ ‡å€¼
        R_new = compute_sum_rate_with_positions(t_new, W_mkn, R_mkn, ...
            alpha_mkn, u, v, H_sense, M, K, N, Na, kappa, sigma2);
        
        % æ­¥éª¤5ï¼šæ”¶æ•›åˆ¤æ–­
        if sca_iter > 1
            improvement = abs(R_new - R_old) / (abs(R_old) + 1e-8);
            fprintf('    æ”¹å–„ç‡: %.6f%%\n', improvement * 100);
            if improvement < tol
                fprintf('  âœ… SCAæ”¶æ•›ï¼è¿­ä»£æ¬¡æ•°: %d\n', sca_iter);
                break;
            end
        end
        
        % æ›´æ–°è¿­ä»£ç‚¹
        t_old = t_new;
    end
    
    % è¿”å›ç»“æœ
    t_opt = t_old;
    fprintf('  æœ€ç»ˆå’Œé€Ÿç‡: %.4f bps/Hz\n', obj_history(end));
end
```

**å…³é”®æ”¹è¿›**ï¼š
1. âœ… **ä¸¤æ­¥SCA**ï¼šå…ˆçº¿æ€§åŒ–g(t)ï¼Œå†å¤„ç†DCå½¢å¼
2. âœ… **ä¿æŒå‡¹æ€§**ï¼šå……åˆ†åˆ©ç”¨logå‡½æ•°çš„å‡¹æ€§
3. âœ… **è§£ææ¢¯åº¦**ï¼šä½¿ç”¨è§£ææ¢¯åº¦è€Œéæ•°å€¼æ¢¯åº¦
4. âœ… **æ ‡å‡†æ–¹æ³•**ï¼šä¸ç†è®ºSCAæ–¹æ³•ä¸€è‡´

### 5.3 è¾…åŠ©å‡½æ•°ï¼šè®¡ç®—å’Œé€Ÿç‡ï¼ˆå¸¦ä½ç½®å‚æ•°ï¼‰

```matlab
function R_sum = compute_sum_rate_with_positions(t, W_mkn, R_mkn, ...
    alpha_mkn, u, v, H_sense, M, K, N, Na, kappa, sigma2)
% è®¡ç®—ç»™å®šä½ç½®tæ—¶çš„é€šä¿¡å’Œé€Ÿç‡
    
    R_sum = 0;
    
    for n = 1:N
        for m = 1:M
            for k = 1:K
                if alpha_mkn(m, k, n) == 1
                    % è®¡ç®—ä¿¡é“ï¼ˆä¾èµ–äºä½ç½®tï¼‰
                    h_mk = compute_channel_with_positions(m, k, n, ...
                        u, v, H_sense, t, kappa, Na);
                    
                    % ä¿¡å·åŠŸç‡
                    signal_power = real(h_mk' * W_mkn{m,k,n} * h_mk);
                    
                    % å¹²æ‰°åŠŸç‡
                    interference = 0;
                    for l = 1:M
                        for i = 1:K
                            if ~(l == m && i == k)
                                h_lk = compute_channel_with_positions(l, k, n, ...
                                    u, v, H_sense, t, kappa, Na);
                                interference = interference + ...
                                    real(h_lk' * W_mkn{l,i,n} * h_lk);
                            end
                        end
                        % æ„ŸçŸ¥ä¿¡å·å¹²æ‰°
                        h_mk_sense = compute_channel_with_positions(m, k, n, ...
                            u, v, H_sense, t, kappa, Na);
                        interference = interference + ...
                            real(h_mk_sense' * R_mkn{m,1,n} * h_mk_sense);
                    end
                    
                    % SINRå’Œé€Ÿç‡
                    SINR = signal_power / (interference + sigma2);
                    R_sum = R_sum + log2(1 + max(SINR, 1e-12));
                end
            end
        end
    end
end
```

### 5.4 è¾…åŠ©å‡½æ•°ï¼šè®¡ç®—ä¿¡é“ï¼ˆå¸¦ä½ç½®å‚æ•°ï¼‰

```matlab
function h = compute_channel_with_positions(m, k, n, u, v, H_sense, t, kappa, Na)
% è®¡ç®—ä¿¡é“ï¼Œä½¿ç”¨ä½ç½®å‘é‡tï¼ˆè€Œä¸æ˜¯å›ºå®šé—´è·dï¼‰
    
    % æå–UAVä½ç½®ï¼ˆå‡è®¾ä»q_trajè·å–ï¼Œè¿™é‡Œç®€åŒ–ï¼‰
    % å®é™…å®ç°ä¸­éœ€è¦ä¼ å…¥q_traj
    qk_2d = [100, 100];  % ç¤ºä¾‹ï¼šéœ€è¦ä»å®é™…è½¨è¿¹è·å–
    um = u(m, :);
    
    % 3Dè·ç¦»
    dx = qk_2d(1) - um(1);
    dy = qk_2d(2) - um(2);
    dist_3d = sqrt(dx^2 + dy^2 + H_sense^2);
    
    % è·¯å¾„æŸè€—
    beta = kappa / dist_3d^2;
    
    % AoD (åˆ°è¾¾è§’)
    cos_theta = H_sense / dist_3d;
    
    % å¯¼å‘çŸ¢é‡ï¼ˆä½¿ç”¨ä½ç½®å‘é‡tï¼‰
    % æ³¨æ„ï¼štæ˜¯å½’ä¸€åŒ–çš„ä½ç½®ï¼ˆä»¥æ³¢é•¿ä¸ºå•ä½ï¼‰
    g = exp(1j * 2*pi * t * cos_theta);
    
    % ä¿¡é“
    h = sqrt(beta) * g;
end
```

---

## 6. å®ç°ç»†èŠ‚

### 6.1 æ¢¯åº¦è®¡ç®—ä¼˜åŒ–

#### æ–¹æ³•1ï¼šè§£ææ¢¯åº¦ï¼ˆç²¾ç¡®ä½†å¤æ‚ï¼‰
- éœ€è¦è®¡ç®—âˆ‚h/âˆ‚tçš„è§£æè¡¨è¾¾å¼
- é€‚ç”¨äºå¯¹ç²¾åº¦è¦æ±‚é«˜çš„åœºæ™¯
- å®ç°å¤æ‚ï¼Œå®¹æ˜“å‡ºé”™

#### æ–¹æ³•2ï¼šæ•°å€¼æ¢¯åº¦ï¼ˆç®€å•ä½†æ…¢ï¼‰
- ä½¿ç”¨æœ‰é™å·®åˆ†æ³•
- å®ç°ç®€å•ï¼Œæ˜“äºè°ƒè¯•
- è®¡ç®—å¼€é”€è¾ƒå¤§

#### æ–¹æ³•3ï¼šè‡ªåŠ¨å¾®åˆ†ï¼ˆæ¨èï¼‰
- ä½¿ç”¨MATLABçš„è‡ªåŠ¨å¾®åˆ†å·¥å…·ï¼ˆå¦‚Deep Learning Toolboxï¼‰
- å¹³è¡¡ç²¾åº¦å’Œæ•ˆç‡
- éœ€è¦é¢å¤–çš„å·¥å…·ç®±æ”¯æŒ

### 6.2 æ”¶æ•›æ€§æ”¹è¿›

#### ä¿¡ä»»åŸŸæ–¹æ³•
é™åˆ¶ä½ç½®å˜åŒ–èŒƒå›´ï¼Œé¿å…å¤§å¹…è·³è·ƒï¼š
```matlab
% æ·»åŠ ä¿¡ä»»åŸŸçº¦æŸ
delta_t_max = 0.1;  % æœ€å¤§å˜åŒ–é‡
for i = 1:Na
    t_var(i) >= t_old(i) - delta_t_max;
    t_var(i) <= t_old(i) + delta_t_max;
end
```

#### æ­¥é•¿æ§åˆ¶
å¦‚æœç›®æ ‡å‡½æ•°ä¸æ”¹å–„ï¼Œå‡å°æ­¥é•¿ï¼š
```matlab
if R_new < R_old
    % ç›®æ ‡å‡½æ•°ä¸‹é™ï¼Œå‡å°ä¿¡ä»»åŸŸ
    delta_t_max = delta_t_max * 0.5;
end
```

### 6.3 åˆå§‹åŒ–ç­–ç•¥

#### å‡åŒ€åˆ†å¸ƒ
```matlab
t_init = linspace(t_start, t_end, Na)';
```

#### éšæœºåˆå§‹åŒ–ï¼ˆæ»¡è¶³çº¦æŸï¼‰
```matlab
t_init = sort(t_start + rand(Na, 1) * (t_end - t_start));
% ç¡®ä¿æœ€å°é—´è·
for i = 2:Na
    if t_init(i) - t_init(i-1) < d_min
        t_init(i) = t_init(i-1) + d_min;
    end
end
```

#### åŸºäºæ³¢æŸä¼˜åŒ–çš„åˆå§‹åŒ–
```matlab
% åˆ†æå½“å‰æ³¢æŸçš„æ–¹å‘ï¼Œåˆå§‹åŒ–ä½ç½®ä»¥åŒ¹é…ä¸»æ³¢æŸæ–¹å‘
% è¿™éœ€è¦é¢å¤–çš„åˆ†æï¼Œä½†å¯èƒ½æä¾›æ›´å¥½çš„åˆå§‹ç‚¹
```

### 6.4 è®¡ç®—å¤æ‚åº¦

- **æ¯æ¬¡SCAè¿­ä»£**ï¼š
  - æ¢¯åº¦è®¡ç®—ï¼šO(Na Ã— M Ã— K Ã— N)ï¼ˆæ•°å€¼æ¢¯åº¦ï¼‰
  - CVXæ±‚è§£ï¼šO(NaÂ³)ï¼ˆå‡¸ä¼˜åŒ–ï¼‰
- **æ€»å¤æ‚åº¦**ï¼šO(max_sca_iter Ã— (Na Ã— M Ã— K Ã— N + NaÂ³))
- **ä¼˜åŒ–å»ºè®®**ï¼š
  - ä½¿ç”¨è§£ææ¢¯åº¦å¯ä»¥å‡å°‘è®¡ç®—é‡
  - å¹¶è¡Œè®¡ç®—å¤šä¸ªGBSçš„ä½ç½®ä¼˜åŒ–
  - ä½¿ç”¨ warm-start åŠ é€ŸCVXæ±‚è§£

---

## 7. ä¸æ³¢æŸä¼˜åŒ–çš„å¯¹æ¯”

### 7.1 ç›¸ä¼¼ç‚¹
- éƒ½ä½¿ç”¨SCAæ–¹æ³•å¤„ç†éå‡¸é—®é¢˜
- éƒ½éœ€è¦çº¿æ€§åŒ–ç›®æ ‡å‡½æ•°
- éƒ½ä½¿ç”¨CVXæ±‚è§£å‡¸ä¼˜åŒ–é—®é¢˜

### 7.2 ä¸åŒç‚¹

| ç‰¹æ€§ | æ³¢æŸä¼˜åŒ– | ä½ç½®ä¼˜åŒ– |
|------|---------|---------|
| ä¼˜åŒ–å˜é‡ | W, R (çŸ©é˜µ) | t (å‘é‡) |
| å˜é‡ç»´åº¦ | Na Ã— Na | Na Ã— 1 |
| çº¦æŸç±»å‹ | åŠå®šçº¦æŸã€åŠŸç‡çº¦æŸ | çº¿æ€§çº¦æŸï¼ˆè¾¹ç•Œã€é—´è·ï¼‰ |
| ç›®æ ‡å‡½æ•° | log(1+SINR)ï¼ŒSINRä¾èµ–äºW, R | log(1+SINR)ï¼ŒSINRä¾èµ–äºtï¼ˆé€šè¿‡h(t)ï¼‰ |
| çº¿æ€§åŒ–æ–¹æ³• | ç›´æ¥çº¿æ€§åŒ–SINR | éœ€è¦å…ˆè®¡ç®—æ¢¯åº¦ï¼Œå†çº¿æ€§åŒ–R_sum |

### 7.3 å…³é”®åŒºåˆ«
**æ³¢æŸä¼˜åŒ–**ä¸­ï¼ŒSINRå…³äºWå’ŒRæ˜¯çº¿æ€§çš„ï¼ˆåœ¨å›ºå®šhçš„æƒ…å†µä¸‹ï¼‰ï¼š
```
SINR = (h' * W * h) / (I + ÏƒÂ²)
```
å…¶ä¸­`h' * W * h`å…³äºWæ˜¯çº¿æ€§çš„ã€‚

**ä½ç½®ä¼˜åŒ–**ä¸­ï¼ŒSINRå…³äºtæ˜¯éçº¿æ€§çš„ï¼ˆå› ä¸ºh(t)å…³äºtæ˜¯éçº¿æ€§çš„ï¼‰ï¼š
```
SINR(t) = (h(t)' * W * h(t)) / (I + ÏƒÂ²)
```
å…¶ä¸­`h(t)`å…³äºtæ˜¯éçº¿æ€§çš„ï¼Œå› æ­¤éœ€è¦æ¢¯åº¦è®¡ç®—å’Œçº¿æ€§åŒ–ã€‚

---

## 8. æ€»ç»“

### 8.1 æ ¸å¿ƒæ­¥éª¤
1. **å›ºå®šæ³¢æŸWå’ŒR**ï¼Œä¼˜åŒ–ä½ç½®t
2. **ä½¿ç”¨SCAæ–¹æ³•**çº¿æ€§åŒ–éå‡¸ç›®æ ‡å‡½æ•°
3. **è®¡ç®—æ¢¯åº¦**ï¼ˆæ•°å€¼æˆ–è§£æï¼‰
4. **æ±‚è§£å‡¸ä¼˜åŒ–é—®é¢˜**ï¼ˆCVXï¼‰
5. **è¿­ä»£ç›´åˆ°æ”¶æ•›**

### 8.2 å…³é”®æŒ‘æˆ˜
1. **æ¢¯åº¦è®¡ç®—**ï¼šéœ€è¦é«˜æ•ˆå‡†ç¡®åœ°è®¡ç®—R_sumå…³äºtçš„æ¢¯åº¦
2. **çº¦æŸå¤„ç†**ï¼šç¡®ä¿ä½ç½®æ»¡è¶³è¾¹ç•Œå’Œé—´è·çº¦æŸ
3. **æ”¶æ•›æ€§**ï¼šSCAæ–¹æ³•å¯èƒ½é™·å…¥å±€éƒ¨æœ€ä¼˜
4. **è®¡ç®—å¤æ‚åº¦**ï¼šæ¯æ¬¡è¿­ä»£éœ€è¦é‡æ–°è®¡ç®—ä¿¡é“å’Œæ¢¯åº¦

### 8.3 å®ç°å»ºè®®
1. **å…ˆå®ç°æ•°å€¼æ¢¯åº¦ç‰ˆæœ¬**ï¼ŒéªŒè¯ç®—æ³•æ­£ç¡®æ€§
2. **ç„¶åä¼˜åŒ–ä¸ºè§£ææ¢¯åº¦**ï¼Œæé«˜è®¡ç®—æ•ˆç‡
3. **ä½¿ç”¨ä¿¡ä»»åŸŸæ–¹æ³•**ï¼Œæ”¹å–„æ”¶æ•›æ€§
4. **å¹¶è¡Œè®¡ç®—**å¤šä¸ªGBSçš„ä½ç½®ä¼˜åŒ–ï¼ŒåŠ é€Ÿæ•´ä½“ç®—æ³•

---

## 9. å‚è€ƒæ–‡çŒ®

1. SCAæ–¹æ³•ï¼šSuccessive Convex Approximation for Non-Convex Optimization
2. æµä½“å¤©çº¿ç³»ç»Ÿï¼šFluid Antenna Systems (FAS)
3. äº¤æ›¿ä¼˜åŒ–ï¼šAlternating Optimization (AO) Algorithm

---

**æœ€åæ›´æ–°**ï¼š2024å¹´
**ä½œè€…**ï¼šAI Assistant
**ç‰ˆæœ¬**ï¼š1.0

